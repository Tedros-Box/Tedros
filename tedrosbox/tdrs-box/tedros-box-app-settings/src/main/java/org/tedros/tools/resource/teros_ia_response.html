<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
      body {
        border: 0; margin: 0;
        background: linear-gradient(135deg, #232526 0%, #414345 100%);
        height: 100vh;
        font-family: 'Segoe UI', Arial, sans-serif;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
     
      #main-content {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-height: 0;
      }

      /* Substituímos o h4 por uma div com a classe .title */
      .title {
        flex-shrink: 0;
        position: relative;
        z-index: 10;
        color: #fff;
        font-weight: 600;
        letter-spacing: 1px;
        margin: 18px 0 0 32px;
        font-size: 1.4em;
        text-shadow: 0 2px 8px rgba(0,0,0,0.18);
        height: 40px;
        /* Garante que o texto fique alinhado verticalmente como no h4 original */
        display: flex;
        align-items: center;
      }
     
      #chat-container {
        flex: 1;
        width: 100%;
        overflow-y: auto;
        padding: 32px 0 32px 0;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 18px;
        align-items: center;
        max-width: 1080px;
        margin: 0 auto;
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 40px, black 100%);
        mask-image: linear-gradient(to bottom, transparent 0%, black 40px, black 100%);
        scrollbar-width: thin;
        scrollbar-color: #546e7a transparent;
      }
      #chat-container::-webkit-scrollbar { width: 8px; }
      #chat-container::-webkit-scrollbar-track { background: transparent; }
      #chat-container::-webkit-scrollbar-thumb { background-color: #546e7a; border-radius: 4px; border: 2px solid transparent; background-clip: content-box; }
      #chat-container::-webkit-scrollbar-thumb:hover { background-color: #78909c; }
     
      .chat-message {
        position: relative;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        margin: 0 24px;
        padding: 18px 26px 26px 26px;
        width: calc(100% - 48px);
        box-sizing: border-box;
        font-size: 16px;
        word-break: break-word;
        transition: box-shadow 0.2s, transform 0.2s;
        animation: fadeIn 0.5s;
        border: 1px solid #e0e0e0;
        z-index: 1;
      }
      .chat-message.ai { border: 1.5px solid #80deea; box-shadow: 0 6px 24px rgba(128,222,234,0.08); }
      .msg-actions { position: absolute; right: 14px; bottom: 8px; display: flex; gap: 8px; }
      .msg-actions button { background: #37474f; color: #fff; border: none; padding: 6px 10px; font-size: 12px; border-radius: 6px; cursor: pointer; opacity: .85; transition: background .15s, opacity .15s; }
      .msg-actions button:hover { background: #455a64; opacity: 1; }
      .msg-actions button:active { background: #263238; }
     
      @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      @media (max-width: 600px) { 
        #chat-container { padding:16px 0; } 
        .chat-message { margin:0 8px; width: calc(100% - 16px); padding:14px 16px 32px 16px; font-size:15px; } 
        .title { margin-left:12px; font-size:1.1em; } 
        .msg-actions { right:10px; bottom:6px; } 
        .msg-actions button { padding:5px 8px; font-size:11px; } 
      }
    </style>
  </head>
  <body>
    <div id="main-content">
      <!-- h4 substituído por div com classe .title -->
      <div class="title">Visualizador de mensagens</div>
      <div id="chat-container"></div>
    </div>

    <script type="text/javascript">
      mermaid.initialize({ startOnLoad: false });
     
      function openExternalLink(url) {
          if (window.app && window.app.openExternalLink) {
              window.app.openExternalLink(url);
          } else {
              window.open(url, '_blank');
          }
      }
      function handleLinkClick(event) {
          const target = event.target;
          if (target.tagName === 'A' && target.href) {
              event.preventDefault();
              openExternalLink(target.href);
          }
      }
      function getRandomBorderColor() {
        const colors = ['#80deea','#ffb74d','#81c784','#ba68c8','#ffd54f','#e57373','#64b5f6','#a1887f','#4db6ac','#f06292'];
        return colors[Math.floor(Math.random() * colors.length)];
      }
      function sanitizeForCopy(node) {
        const clone = node.cloneNode(true);
        const actions = clone.querySelector('.msg-actions');
        if (actions) actions.remove();
        return clone.innerText.trim();
      }
      function copyMessage(msgDiv) {
        const textToCopy = sanitizeForCopy(msgDiv.querySelector('.msg-content') || msgDiv);
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(textToCopy).then(() => flashFeedback(msgDiv,'Copiado')).catch(() => legacyCopy(textToCopy,msgDiv));
        } else { legacyCopy(textToCopy,msgDiv); }
      }
      function legacyCopy(text, msgDiv) {
        const textarea = document.createElement('textarea');
        textarea.value = text; document.body.appendChild(textarea); textarea.select();
        try { document.execCommand('copy'); flashFeedback(msgDiv,'Copiado'); } catch(e) { flashFeedback(msgDiv,'Falhou'); }
        document.body.removeChild(textarea);
      }
      function flashFeedback(msgDiv, label) {
        const tag = document.createElement('div');
        tag.textContent = label;
        tag.style.position = 'absolute'; tag.style.top = '8px'; tag.style.right = '16px';
        tag.style.background = '#009688'; tag.style.color = '#fff'; tag.style.padding = '4px 8px';
        tag.style.fontSize = '11px'; tag.style.borderRadius = '4px'; tag.style.boxShadow = '0 2px 6px rgba(0,0,0,0.25)'; tag.style.zIndex = '10';
        msgDiv.appendChild(tag); setTimeout(() => tag.remove(), 1400);
      }
      function createActionsBar(msgDiv) {
        const actionsDiv = document.createElement('div'); actionsDiv.className = 'msg-actions';
        const copyBtn = document.createElement('button'); copyBtn.type='button'; copyBtn.title='Copiar conteúdo'; copyBtn.innerHTML='Copiar'; copyBtn.addEventListener('click', () => copyMessage(msgDiv));
        actionsDiv.appendChild(copyBtn);
        msgDiv.appendChild(actionsDiv);
      }
      function appendAIResponse(text, isAI = true) {
        const container = document.getElementById('chat-container');
        const msgDiv = document.createElement('div');
        msgDiv.className = 'chat-message' + (isAI ? ' ai' : '');
        msgDiv.style.borderColor = getRandomBorderColor();
       
        const contentDiv = document.createElement('div');
        contentDiv.className='msg-content';
        contentDiv.innerHTML = text;
       
        contentDiv.addEventListener('click', handleLinkClick);
        msgDiv.appendChild(contentDiv);
        createActionsBar(msgDiv);
        container.appendChild(msgDiv);
        container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        const mermaidDivs = msgDiv.querySelectorAll('.mermaid'); mermaidDivs.forEach(el => { try { mermaid.init(undefined, el); } catch(e) {} });
      }
    </script>
  </body>
</html>